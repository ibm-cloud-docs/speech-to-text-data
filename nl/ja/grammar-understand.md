---

copyright:
  years: 2018, 2019
lastupdated: "2019-06-11"

subcollection: speech-to-text-data

---

{:shortdesc: .shortdesc}
{:external: target="_blank" .external}
{:tip: .tip}
{:important: .important}
{:note: .note}
{:deprecated: .deprecated}
{:pre: .pre}
{:codeblock: .codeblock}
{:screen: .screen}
{:javascript: .ph data-hd-programlang='javascript'}
{:java: .ph data-hd-programlang='java'}
{:python: .ph data-hd-programlang='python'}
{:swift: .ph data-hd-programlang='swift'}

# 文法の理解
{: #grammarUnderstand}

以下の例では、{{site.data.keyword.speechtotextdatafull}} for {{site.data.keyword.icp4dfull}} サービスによる文法のサポートを紹介しています。これらの例では、2 つのシンプルな ABNF 文法を作成して、これらの文法が音声認識用に使用されたときに得られる可能性のある結果を示しています。これらの例では、サービスによって書き起こし結果に付加される信頼度スコアを調べることの重要性を示しています。
{: shortdesc}

これらの例では、音声認識要求の結果のみを示しています。 音声認識用の文法を渡す方法の例については、[音声認識での文法の使用](/docs/services/speech-to-text-data?topic=speech-to-text-data-grammarUse)を参照してください。 また、これらの例は非常に基本的なものです。 より複雑な文法の例については、[文法の例](/docs/services/speech-to-text-data?topic=speech-to-text-data-grammarExamples)を参照してください。

## 単一句の一致: yesno 文法
{: #yesnoGrammar}

1 つ目の例では、2 つの有効な単一語応答 (`yes` と `no`) を受け付ける非常にシンプルな `yesno` 文法を定義します。この文法が役に立つのは、ユーザーが 2 つの句の一方のみを応答として返す必要がある場合です。

```
#ABNF 1.0 ISO-8859-1;
language en-US;
mode voice;
root $yesno;

$yesno = yes | no ;
```
{: codeblock}

この文法を音声認識要求に適用した場合、サービスは、書き起こし結果の一致信頼度を示すスコアが付加された書き起こし結果を返すことができます。 入力が 2 つの句のどちらにも明らかに一致していない場合は、サービスから結果が返されない可能性もあります。

例えば、ユーザーが `yes` と応答した場合は、次の結果とよく似た応答がサービスから返される可能性が高くなります。 下記の `confidence` フィールド内のスコアは、最大限の一致信頼度を示しています。

```
{
  "results": [
      {
      "alternatives": [
            {
          "confidence": 1.0,
          "transcript": "yes"
        }
      ],
         "final": true
      }
  ],
   "result_index": 0
}
```
{: codeblock}

代わりに、ユーザーが例えば `nope` と応答した場合を考えてみましょう。 その場合、サービスは非常に低い信頼度スコアが付加された結果を返す可能性も、結果をまったく返さない可能性もあります。 空の結果は、応答が文法に一致していないことを最も明確に示しています。 空の応答が生じる可能性が高いのは、有効な応答が特定の連続した複数句に一致する必要のある複雑な文法の場合です。

## 複数句の一致: names 文法
{: #namesGrammar}

複数句文法を使用している場合は、ユーザーの応答は認識されるためには完全な応答である必要があります。 ユーザーは 1 語も省略できず、応答を途中で停止することもできません。 1 語でも欠落していると、空の結果が返されます。

さらに、ユーザーが発話する複数の句が、それらの句が独立した発話であることを示すのに十分な長さの無音で区切られている場合は、サービスによって複数の書き起こし結果が返される可能性があります。 例えば、複数語からなる 3 つの名前のいずれかに一致可能なシンプルな `names` 文法について考えてみましょう。

```
#ABNF 1.0 ISO-8859-1;
language en-US;
mode voice;
root $names;
$names = Yi Wen Tan | Yon See | Youngjoon Lee ;
```
{: codeblock}

例えば、ユーザーがこの文法のルールに含まれる名前の 1 つである `Yon See` を発話するとします。 サービスからは、非常に高い一致信頼度を示す応答が返されます。

```
{
  "results": [
      {
      "alternatives": [
            {
          "confidence": 0.92,
          "transcript": "Yon See"
        }
      ],
         "final": true
      }
  ],
   "result_index": 0
}
```
{: codeblock}

次に、ユーザーが 2 つの名前を発話する場合を考えてみましょう。これらの名前は、それらが別々の発話であることを示すのに十分な長さの無音 (0.8 秒以上) で区切られています。具体的には、`Yon See` という名前の後に、1.0 秒間の無音が挿入されてから、`Yi Wen Tan` という名前が発話されます。 この場合は、それぞれの書き起こし結果の異なる信頼度スコアが付加された 2 つの別々の応答がサービスから返されます。

```
{
  "results": [
      {
      "alternatives": [
            {
          "confidence": 0.92,
          "transcript": "Yon See"
        }
      ],
         "final": true
      }
  ],
   "result_index": 0
},
{
  "results": [
      {
      "alternatives": [
            {
          "confidence": 0.83,
          "transcript": "Yi Wen Tan"
        }
      ],
         "final": true
      }
  ],
  "result_index": 1
}
```
{: codeblock}

最後のケースとして、先ほどとは異なり、ユーザーが `Yon See` と発話した後に、1.0 秒間の無音を挿入してから、`Young Says He` と発話した場合を考えてみましょう。 1 つ目の句 `Yon See` については、これまでの例と同様に、信頼度スコアが付加された確実な一致結果がサービスから返されます。 2 つ目の句 `Young Says He` については、次の 2 つの応答候補のいずれかがサービスから返される可能性があります。

-   何の応答も返されない可能性があります。これは、この句が文法のルールのいずれにも一致しないことを意味します。
-   代わりに、低い信頼度スコアが付加された応答が返される可能性があります。これは、この句がいずれかのルールに音響的には類似しているが、一致している可能性は高くないことを意味します。

## 信頼度スコアと空の結果
{: #confidenceScores}

これまでに紹介した例のように比較的シンプルな文法の場合は、応答が文法とまったく一致していないように思われる場合でも、低い信頼度スコアが付加された結果がサービスから返される可能性があります。 このことは意外に感じられるかもしれませんが、低い信頼度スコアが付加された応答は、その応答が文法に一致している可能性が低い場合でも、サービスが受け取った音声について見つけることができる最善の一致結果を示している可能性があります。 この応答が文法に一致していない場合は、結果の信頼度スコアは一般に、文法によってその応答を生成できる可能性がほぼないことを示すのに十分な低い値になります。

応答が文法に適合しているかどうかを検証する際は、常に信頼度スコアを考慮してください。 結果を却下する基準となる信頼度のしきい値をいくらに設定すべきかわからない場合は、0.5 という初期値を使用してください。 正しい結果の却下率が異常に高い場合は、信頼度のしきい値を小さくしてください。例えば、0.1 は一部のアプリケーションに対して適切な値である可能性があります。 誤認識が多く発生する場合は、ご使用のアプリケーションに対して信頼度のしきい値を大きくしてください。

多くの場合は、空の結果や非常に低い信頼度スコアが付加された結果は有効な応答です。 これらの結果は、ユーザーが質問や提示されたオプションを理解していなかったことを意味している可能性があります。 文法を使用しなくてもユーザーの音声応答を常に認識できますが、その場合は、文法に適合していない結果が得られるリスクが生じます。 文法を使用すると、n-gram より信頼度の高い結果が得られます。n-gram を使用した場合は、完全な無音以外のどのような発話に対しても、常に何らかの結果が返されるからです。

結果が必ず、文法で定義された有効な句のいずれかに一致するとわかっていることは、アプリケーションの応答処理を簡素化するのに大きく役立ちます。 一般的に、サービスが信頼度の高い結果を返すことができるのは、文法によって生成された発話に対してのみです。 1 つ目の例の `yesno` 文法で `nope` という句が有効な応答として確実に認識されるためには、この句をこの文法に追加する必要があります。
